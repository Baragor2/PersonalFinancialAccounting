<!DOCTYPE html>
<html>
<head>
    <title>Financial report</title>
    <style>
        body { font-family: sans-serif; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .total { font-weight: bold; }
        .income { color: green; }
        .expense { color: red; }
    </style>
</head>
<body>
    <h2>Hello, {{ user.first_name|default:user.username }}!</h2>
    <p>Financial report from {{ start_date|date:"d.m.Y" }} to {{ end_date|date:"d.m.Y" }}.</p>

    <h3>Expenses: <span class="expense">-{{ data.expense.total|floatformat:2 }}</span></h3>
    {% if data.expense.categories %}
        {% for category in data.expense.categories %}
            <h4>Category: {{ category.category_title }}</h4>
            <table>
                <thead><tr><th>Date</th><th>Sum</th><th>Description</th></tr></thead>
                <tbody>
                {% for tx in category.transactions %}
                    <tr>
                        <td>{{ tx.date }}</td>
                        <td>{{ tx.value }}</td>
                        <td>{{ tx.description|default:"-" }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    {% else %}
        <p>No expenses in the period</p>
    {% endif %}

    <h3>Incomes: <span class="income">+{{ data.income.total|floatformat:2 }}</span></h3>
    {% if data.income.categories %}
        {% for category in data.income.categories %}
            <h4>Category: {{ category.category_title }}</h4>
            <table>
                <thead><tr><th>Date</th><th>Sum</th><th>Description</th></tr></thead>
                <tbody>
                {% for tx in category.transactions %}
                    <tr>
                        <td>{{ tx.date }}</td>
                        <td>{{ tx.value }}</td>
                        <td>{{ tx.description|default:"-" }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endfor %}
    {% else %}
        <p>No incomes in the period</p>
    {% endif %}
    <hr>
    <h3>Result</h3>
    <p class="total">Final balance {{ data.final_balance|floatformat:2 }}</p>

</body>
</html>
